<!-- JS links for flipdownd -->

<!-- <script type="text/javascript" src="js/flipdown/flipdown.js"></script> -->
<!-- <script type="text/javascript" src="js/main.js"></script> -->



<% content_for :head do %>
  <meta name="turbolinks-cache-control" content="no-cache">
<% end %>

<div class="container-track-show col-12">

  <%# case 1 before joining race  %>

  <% if !@race.present? %>
  <div class="container-top">
    <div class="track-details row">

      <div class="map-container col-12 col-sm-12 col-md-6">
        <div class="map-with-button">
          <div class="track-map col-12">
            <div id="map"
              style="width: 100%; height: 100%;"
              data-markers="<%= @markers.to_json %>"
              data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"></div>
          </div>
        </div>
      </div>


      <div class="track-descrption col-12 col-sm-12 col-md-6">
        <h1><%= @track.name %></h1>
        <div id='trackdata' data-date=<%= @date.to_s %>></div>
        <div class="flipdown-centralize">
            <div id="flipdown" class="flipdown"></div>
        </div>
        <h3 class='track-race-details subtitle'>Race Details:</h3>
        <p><%= "#{@track.distance} Km - #{@track.distance * 0.621} Miles" %><p>
        <p><%= "Date: #{@track.date} Time: #{@track.time_to_start}" %></p>
        <p class="subtitle">Description: </p>
        <p><%=@track.description%></p>
        <%# join race button %>
        <%= link_to track_races_path(@track), method: :POST, remote: true do %>
          <p class='btn btn-danger' id='sweet-alert-join'> Join this Race</p>
        <% end %>
      </div>
    </div>
  </div>

    <div class="background-container">
      <div class='container-race-info'>
        <ul class="nav nav-tabs" id="myTab" role="tablist">
          <li class="nav-item" role="presentation">
            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Instructions</a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Runners</a>
          </li>
        </ul>
        <div class="tab-content" id="myTabContent">
          <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="Instructions-tab">

            <h2> Make sure you read this before your race! </h2>
            <ol>
              <li> Join the race you want to participate in.</li>
              <li> A scheduled event will created for you. The countdown will start running.</li>
              <li> If you are unable to assist the challenge please cancel before the race's date.</li>
              <li> If you dont have the strava app on your running device please install it. Here is a link:</li>
              <li> On the day of the Race. Comeback to your event and start whenever you are ready with the start running button.</li>
              <li> Go to strava and and press record.</li>
              <li> On your marks, set go!! Start running (Your time will be counted from this point on!).</li>
              <li> Make sure you complete the distance for the specific challenge before finishing your run.</li>
              <li> Stop your run in strava (race time will end from this point on!)</li>
              <li> Feel free to name your acticity as you wish to.</li>
              <li> Come back to this page and hit the finished race button.
              <li> Check out your results and ranking!</li>
            </ol>
          </div>
          <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="Runners-tab">

                <div class="grids-profiles">
                  <% @users.each do |user| %>
                    <%= link_to user_path(user) do %>
                      <% if user.photo.attached? %>
                            <div class="grid-profile"><%= cl_image_tag user.photo.key, class:'avatar'%></div>
                      <% else %>
                            <div class="grid-profile"><%= image_tag "avatar-default-copy.png", crop: :fill, class:'avatar' %></div>
                      <% end %>
                    <% end %>
                  <%end %>
                </div>

          </div>
        </div>
      </div>
    </div>


    <%# case 2 already joined race %>
  <% else %>

    <% if @race.status == "finished" %>

   <div class="container-top">
    <div class="track-details row">

      <div class="map-container col-12 col-sm-12 col-md-6">
        <div class="map-with-button">
          <div class="track-map col-12">
            <div id="map"
              style="width: 100%; height: 100%;"
              data-markers="<%= @markers.to_json %>"
              data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"></div>
          </div>
        </div>
      </div>

        <div class="track-descrption col-6">
          <h1><%= @track.name %></h1>
          <div id='trackdata' data-date=<%= @date.to_s %>></div>
          <div class="flipdown-centralize">
              <div id="flipdown" class="flipdown"></div>
          </div>
          <h3 class='track-race-details'>Race Details</h3>
          <p><%= "#{@track.distance} Km - #{@track.distance * 0.621} Miles" %><p>
          <p><%= "Date: #{@track.date} Time: #{@track.time_to_start}" %></p>
          <p>Description</p>
          <p><%=@track.description%></p>
        </div>
      </div>
    </div>


      <div class="background-container">
        <div class='container-race-info'>
          <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
              <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Ranking</a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Your Stats</a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Runners</a>
            </li>
          </ul>
          <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">

                <% @leaderboard.each do |runner| %>

                      <table class="table table-borderless">
                        <thead>
                          <tr>
                            <th scope="col">Place</th>
                            <th scope="col"></th>
                            <th scope="col">Name</th>
                            <th scope="col">Time</th>
                          </tr>
                        </thead>
                        <tbody>
                          <th scope="row">1</th>
                          <%= link_to user_path(runner.user) do %>
                            <% if runner.user.photo.attached? %>
                              <td><%= cl_image_tag runner.user.photo.key, class:'avatar'%></td>
                            <% else %>
                              <td><%= image_tag "avatar-default-copy.png", crop: :fill, class:'avatar' %></td>
                            <% end %>
                          <% end %>
                          <td><%= runner.user.name %></td>
                          <td><%= runner.elapsed_time %></td>
                          </tbody>
                          </table>

                <% end %>


            </div>
            <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
              <p>Time: <%= @race.elapsed_time %></p>
              <p></p>
              <p>Average Speed: <%= @race.average_speed %></p>
              <p>Maximum Speed: <%= @race.max_speed %></p>
            </div>
            <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">

              <p>Finished Runners</p>
              <% @finished_races.each do |race| %>
              <%= link_to user_path(race.user) do %>
                  <% if race.user.photo.attached? %>
                        <div class="runner-avatar"><%= cl_image_tag race.user.photo.key, class:'avatar'%></div>
                  <% else %>
                        <div class="runner-avatar"><%= image_tag "avatar-default-copy.png", crop: :fill, class:'avatar' %></div>
                  <% end %>
                <% end %>
              <% end %>


              <p>Active Runners</p>
              <% @ongoing_races.each do |race| %>
              <%= link_to user_path(race.user) do %>
                  <% if race.user.photo.attached? %>
                        <div class="runner-avatar"><%= cl_image_tag race.user.photo.key, class:'avatar'%></div>
                  <% else %>
                        <div class="runner-avatar"><%= image_tag "avatar-default-copy.png", crop: :fill, class:'avatar' %></div>
                  <% end %>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      </div>

    <% else %>

    <div class="container-top">
    <div class="track-details row">

      <div class="map-container col-12 col-sm-12 col-md-6">
        <div class="map-with-button">
          <div class="track-map col-12">
            <div id="map"
              style="width: 100%; height: 100%;"
              data-markers="<%= @markers.to_json %>"
              data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"></div>
          </div>
        </div>
      </div>

        <div class="track-descrption col-6">
          <h1><%= @track.name %></h1>
          <div id='trackdata' data-date=<%= @date.to_s %>></div>
          <div class="flipdown-centralize">
              <div id="flipdown" class="flipdown"></div>
          </div>
          <h3 class='track-race-details'>Race Details</h3>
          <p><%= "#{@track.distance} Km - #{@track.distance * 0.621} Miles" %><p>
          <p><%= "Date: #{@track.date} Time: #{@track.time_to_start}" %></p>
          <p>Description</p>
          <p><%=@track.description%></p>
          <%# Button if time or not  %>
          <% if @track.date == Date.today %>
            <div class="d-flex">
              <% if @race.status == "ongoing"%>
                <%= link_to "Finished Running", track_path(@track),class: "btn-finish btn-primary"  %>
              <% else %>
                <%= link_to "Start Running", start_running_race_path(@race), method: "post", class: "btn-run btn-primary" %>
              <% end %>
              <%= link_to track_race_path(@track, @race), method: :DELETE, remote: true do %>
                <p class='btn btn-danger'> Leave Race </p>
              <% end %>
            </div>
          <% else %>
            <%= link_to track_race_path(@track, @race), method: :DELETE, remote: true do %>
                <p class='btn btn-danger'> Leave Race </p>
            <% end %>
          <% end %>
        </div>
      </div>
    <div>

      <% if @track.date == Date.today %>

        <% if @leaderboard.first.present? %>
          <div class="card">
            <div class="card-body">
              <p> Time to Beat <p>
              <%= @leaderboard.first.elapsed_time %>
            </div>
          </div>
        <% end %>

        <div class="background-container">
          <div class='container-race-info'>
            <ul class="nav nav-tabs" id="myTab" role="tablist">
              <li class="nav-item" role="presentation">
                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Instructions</a>
              </li>
              <li class="nav-item" role="presentation">
                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Runners</a>
              </li>
            </ul>
            <div class="tab-content" id="myTabContent">
              <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="Instructions-tab">

                <h2> Make sure you read this before your race! </h2>

                <ol>
                  <li> Join the race you want to participate in.</li>
                  <li> A scheduled event will created for you. The countdown will start running.</li>
                  <li> If you are unable to assist the challenge please cancel before the race's date.</li>
                  <li> If you dont have the strava app on your running device please install it. Here is a link:</li>
                  <li> On the day of the Race. Comeback to your event and start whenever you are ready with the start running button.</li>
                  <li> Go to strava and and press record.</li>
                  <li> On your marks, set go!! Start running (Your time will be counted from this point on!).</li>
                  <li> Make sure you complete the distance for the specific challenge before finishing your run.</li>
                  <li> Stop your run in strava (race time will end from this point on!)</li>
                  <li> Feel free to name your acticity as you wish to.</li>
                  <li> Come back to this page and hit the finished race button.
                  <li> Check out your results and ranking!</li>
                </ol>
              </div>
              <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="Runners-tab">
                <div class="active-runners">
                  <p>Active Runners</p>
                  <div class="grids-profiles">
                    <% @ongoing_races.each do |race| %>
                    <%= link_to user_path(race.user) do %>
                        <% if race.user.photo.attached? %>
                              <div class="grids-profile"><%= cl_image_tag race.user.photo.key, class:'avatar'%></div>
                        <% else %>
                              <div class="grids-profile"><%= image_tag "avatar-default-copy.png", crop: :fill, class:'avatar' %></div>
                        <% end %>
                      <% end %>
                    <% end %>
                  </div>
                </div>

                  <div class="signed-up-runners">
                    <div class="runners-avatar">
                      <p> All competitors</p>
                      <div class="grids-profiles">
                        <% @users.each do |user| %>
                          <%= link_to user_path(user) do %>
                            <% if user.photo.attached? %>
                                  <div class="grid-profile"><%= cl_image_tag user.photo.key, class:'avatar'%></div>
                            <% else %>
                                  <div class="grid-profile"><%= image_tag "avatar-default-copy.png", crop: :fill, class:'avatar' %></div>
                            <% end %>
                          <% end %>
                        <%end %>
                    </div>
                    </div>
                  </div>

              </div>
            </div>
          </div>
        </div>
      <% else %>

        <div class="background-container">
          <div class='container-race-info'>
            <ul class="nav nav-tabs" id="myTab" role="tablist">
              <li class="nav-item" role="presentation">
                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Instructions</a>
              </li>
              <li class="nav-item" role="presentation">
                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Runners</a>
              </li>
            </ul>
            <div class="tab-content" id="myTabContent">
              <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="Instructions-tab">

                <h2> Make sure you read this before your race! </h2>

                <ol>
                  <li> Join the race you want to participate in.</li>
                  <li> A scheduled event will created for you. The countdown will start running.</li>
                  <li> If you are unable to assist the challenge please cancel before the race's date.</li>
                  <li> If you dont have the strava app on your running device please install it. Here is a link:</li>
                  <li> On the day of the Race. Comeback to your event and start whenever you are ready with the start running button.</li>
                  <li> Go to strava and and press record.</li>
                  <li> On your marks, set go!! Start running (Your time will be counted from this point on!).</li>
                  <li> Make sure you complete the distance for the specific challenge before finishing your run.</li>
                  <li> Stop your run in strava (race time will end from this point on!)</li>
                  <li> Feel free to name your acticity as you wish to.</li>
                  <li> Come back to this page and hit the finished race button.
                  <li> Check out your results and ranking!</li>
                </ol>
              </div>
              <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="Runners-tab">

                    <div class="grids-profiles">
                      <% @users.each do |user| %>
                        <%= link_to user_path(user) do %>
                          <% if user.photo.attached? %>
                                <div class="grids-profile"><%= cl_image_tag user.photo.key, class:'avatar'%></div>
                          <% else %>
                                <div class="grids-profile"><%= image_tag "avatar-default-copy.png", crop: :fill, class:'avatar' %></div>
                          <% end %>
                        <% end %>
                      <%end %>
                    </div>

              </div>
            </div>
          </div>
        </div>
      <% end %>

    <% end %>
  <% end %>





</div>










