<!-- JS links for flipdownd -->

<script type="text/javascript" src="js/flipdown/flipdown.js"></script>
<script type="text/javascript" src="js/main.js"></script>







<div class="container-track-show col-12">

  <%# case 1 before joining race  %>

  <% if !@race.present? %>
    <div class="track-details d-flex">
      <div class="map-container col-6">
        <div class="map-with-button">
          <div class="track-map col-8">
            <div id="map"
              style="width: 100%; height: 100%;"
              data-markers="<%= @markers.to_json %>"
              data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"></div>
          </div>
        </div>
      </div>

      <div class="track-descrption col-6">
        <h1><%= @track.name %></h1>
        <div id='trackdata' data-date=<%= @date.to_s %>></div>
        <div class="flipdown-centralize">
            <div id="flipdown" class="flipdown"></div>
        </div>
        <h3>Race Details</h3>
        <p><%= "#{@track.distance} Km - #{@track.distance * 0.621} Miles" %><p>
        <p><%= "Date: #{@track.date} Time: #{@track.time_to_start}" %></p>
        <p>Description</p>
        <p><%=@track.description%></p>
        <%# join race button %>
        <%= link_to track_races_path(@track), method: :POST, remote: true do %>
          <p class='btn btn-danger' id='sweet-alert-join'> Join this Race</p>
        <% end %>
      </div>
    </div>

    <div class="background-container">
      <div class='container-race-info'>
        <ul class="nav nav-tabs" id="myTab" role="tablist">
          <li class="nav-item" role="presentation">
            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Instructions</a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Runners</a>
          </li>
        </ul>
        <div class="tab-content" id="myTabContent">
          <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="Instructions-tab">

            <h2> Make sure you read this before your race! </h2>

            <p> 1) Join the race you want to participate in.
            2) This will create a scheduled event for you. The countdown will start running.
            3) If you are unable to assist the challenge please cancel before the race's date.
            4) If you dont have the strava app on your running device please install. Here is a link:
            5) On the day of the Race. Comeback to your event and start whenever you are ready with the start running button.
            6) Go to strava and and press record.
            7) On your marks, set go!! Start running (time will be counted from this time on!)
            8) Make sure you complete the distance for the specific challenge before finishing your run.
            9) Stop your run in strava  (race time will end from this point!)
            10) Feel free to name your acticity as you wish to.
            11) Come back to this page and hit the finished race button.
            12) Check out your results and ranking!</p>
          </div>
          <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="Runners-tab">

                <div class="runners-avatar">
                  <% @users.each do |user| %>
                    <%= link_to user_path(user) do %>
                      <% if user.photo.attached? %>
                            <div class="runner-avatar"><%= cl_image_tag user.photo.key, class:'avatar'%></div>
                      <% else %>
                            <div class="runner-avatar"><%= image_tag "avatar-default-copy.png", crop: :fill, class:'avatar' %></div>
                      <% end %>
                    <% end %>
                  <%end %>
                </div>

          </div>
        </div>
      </div>
    </div>


    <%# case 2 already joined race %>
  <% else %>

    <% if @race.status == "finished" %>

      <div class="track-details d-flex">
        <div class="map-container col-6">
          <div class="map-with-button">
            <div class="track-map col-8">
              <div id="map"
                style="width: 100%; height: 100%;"
                data-markers="<%= @markers.to_json %>"
                data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"></div>
            </div>
          </div>
        </div>

        <div class="track-descrption col-6">
          <h1><%= @track.name %></h1>
          <div id='trackdata' data-date=<%= @date.to_s %>></div>
          <div class="flipdown-centralize">
              <div id="flipdown" class="flipdown"></div>
          </div>
          <h3>Race Details</h3>
          <p><%= "#{@track.distance} Km - #{@track.distance * 0.621} Miles" %><p>
          <p><%= "Date: #{@track.date} Time: #{@track.time_to_start}" %></p>
          <p>Description</p>
          <p><%=@track.description%></p>
        </div>
      </div>


      <div class="background-container">
        <div class='container-race-info'>
          <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
              <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Ranking</a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Your Stats</a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Runners</a>
            </li>
          </ul>
          <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">

                <% @leaderboard.each do |runner| %>

                      <table class="table table-borderless">
                        <thead>
                          <tr>
                            <th scope="col">Place</th>
                            <th scope="col"></th>
                            <th scope="col">Name</th>
                            <th scope="col">Time</th>
                          </tr>
                        </thead>
                        <tbody>
                          <th scope="row">1</th>
                          <%= link_to user_path(runner.user) do %>
                            <% if runner.user.photo.attached? %>
                              <td><%= cl_image_tag runner.user.photo.key, class:'avatar'%></td>
                            <% else %>
                              <td><%= image_tag "avatar-default-copy.png", crop: :fill, class:'avatar' %></td>
                            <% end %>
                          <% end %>
                          <td><%= runner.user.name %></td>
                          <td><%= runner.elapsed_time %></td>
                          </tbody>
                          </table>

                <% end %>


            </div>
            <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
              <p>Time: <%= @race.elapsed_time %></p>
              <p></p>
              <p>Average Speed: <%= @race.average_speed %></p>
              <p>Maximum Speed: <%= @race.max_speed %></p>
            </div>
            <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">

              <p>Finished Runners</p>
              <% @finished_races.each do |race| %>
              <%= link_to user_path(race.user) do %>
                  <% if race.user.photo.attached? %>
                        <div class="runner-avatar"><%= cl_image_tag race.user.photo.key, class:'avatar'%></div>
                  <% else %>
                        <div class="runner-avatar"><%= image_tag "avatar-default-copy.png", crop: :fill, class:'avatar' %></div>
                  <% end %>
                <% end %>
              <% end %>


              <p>Active Runners</p>
              <% @ongoing_races.each do |race| %>
              <%= link_to user_path(race.user) do %>
                  <% if race.user.photo.attached? %>
                        <div class="runner-avatar"><%= cl_image_tag race.user.photo.key, class:'avatar'%></div>
                  <% else %>
                        <div class="runner-avatar"><%= image_tag "avatar-default-copy.png", crop: :fill, class:'avatar' %></div>
                  <% end %>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      </div>

    <% else %>

      <div class="track-details d-flex">
        <div class="map-container col-6">
          <div class="map-with-button">
            <div class="track-map col-8">
              <div id="map"
                style="width: 100%; height: 100%;"
                data-markers="<%= @markers.to_json %>"
                data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"></div>
            </div>
          </div>
        </div>

        <div class="track-descrption col-6">
          <h1><%= @track.name %></h1>
          <div id='trackdata' data-date=<%= @date.to_s %>></div>
          <div class="flipdown-centralize">
              <div id="flipdown" class="flipdown"></div>
          </div>
          <h3>Race Details</h3>
          <p><%= "#{@track.distance} Km - #{@track.distance * 0.621} Miles" %><p>
          <p><%= "Date: #{@track.date} Time: #{@track.time_to_start}" %></p>
          <p>Description</p>
          <p><%=@track.description%></p>
          <%# Button if time or not  %>
          <% if @track.date == Date.today %>
            <div class="d-flex">
              <% if @race.status == "ongoing"%>
                <%= link_to "Finished Running", track_path(@track),class: "btn btn-primary"  %>
              <% else %>
                <%= link_to "Start Running", start_running_race_path(@race), method: "post", class: "btn btn-primary" %>
              <% end %>
              <%= link_to track_race_path(@track, @race), method: :DELETE, remote: true do %>
                <p class='btn btn-danger'> Leave Race </p>
              <% end %>
            </div>
          <% else %>
            <%= link_to track_race_path(@track, @race), method: :DELETE, remote: true do %>
                <p class='btn btn-danger'> Leave Race </p>
            <% end %>
          <% end %>
        </div>
      </div>

      <% if @track.date == Date.today %>

        <% if @leaderboard.first.present? %>
          <div class="card">
            <div class="card-body">
              <p> Time to Beat <p>
              <%= @leaderboard.first.elapsed_time %>
            </div>
          </div>
        <% end %>

        <div class="background-container">
          <div class='container-race-info'>
            <ul class="nav nav-tabs" id="myTab" role="tablist">
              <li class="nav-item" role="presentation">
                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Instructions</a>
              </li>
              <li class="nav-item" role="presentation">
                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Runners</a>
              </li>
            </ul>
            <div class="tab-content" id="myTabContent">
              <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="Instructions-tab">

                <h2> Make sure you read this before your race! </h2>

                <p> 1) Join the race you want to participate in
                2) This will create a scheduled event for you. The countdown will start running.
                3) If you are unable to assist the challenge please cancel before the race's date.
                4) If you dont have the strava app on your running device please install. Here is a link:
                5) On the day of the Race. Comeback to your event and start whenever you are ready with the start running button.
                6) Go to strava and and press record.
                7) On your marks, set go!! Start running (time will be counted from this time on!)
                8) Make sure you complete the distance for the specific challenge before finishing your run.
                9) Stop your run in strava  (race time will end from this point!)
                10) Feel free to name your acticity as you wish to.
                11) Come back to this page and hit the finished race button.
                12) Check out your results and ranking!</p>
              </div>
              <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="Runners-tab">
                <div class="active-runners">
                  <p>Active Runners</p>
                  <% @ongoing_races.each do |race| %>
                  <%= link_to user_path(race.user) do %>
                      <% if race.user.photo.attached? %>
                            <div class="runner-avatar"><%= cl_image_tag race.user.photo.key, class:'avatar'%></div>
                      <% else %>
                            <div class="runner-avatar"><%= image_tag "avatar-default-copy.png", crop: :fill, class:'avatar' %></div>
                      <% end %>
                    <% end %>
                  <% end %>
                </div>

                  <div class="signed-up-runners"
                    <div class="runners-avatar">
                      <p> All competitors</p>
                      <% @users.each do |user| %>
                        <%= link_to user_path(user) do %>
                          <% if user.photo.attached? %>
                                <div class="runner-avatar"><%= cl_image_tag user.photo.key, class:'avatar'%></div>
                          <% else %>
                                <div class="runner-avatar"><%= image_tag "avatar-default-copy.png", crop: :fill, class:'avatar' %></div>
                          <% end %>
                        <% end %>
                      <%end %>
                    </div>
                  </div>

              </div>
            </div>
          </div>
        </div>
      <% else %>

        <div class="background-container">
          <div class='container-race-info'>
            <ul class="nav nav-tabs" id="myTab" role="tablist">
              <li class="nav-item" role="presentation">
                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Instructions</a>
              </li>
              <li class="nav-item" role="presentation">
                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Runners</a>
              </li>
            </ul>
            <div class="tab-content" id="myTabContent">
              <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="Instructions-tab">

                <h2> Make sure you read this before your race! </h2>

                <p> 1) Join the race you want to participate in
                2) This will create a scheduled event for you. The countdown will start running.
                3) If you are unable to assist the challenge please cancel before the race's date.
                4) If you dont have the strava app on your running device please install. Here is a link:
                5) On the day of the Race. Comeback to your event and start whenever you are ready with the start running button.
                6) Go to strava and and press record.
                7) On your marks, set go!! Start running (time will be counted from this time on!)
                8) Make sure you complete the distance for the specific challenge before finishing your run.
                9) Stop your run in strava  (race time will end from this point!)
                10) Feel free to name your acticity as you wish to.
                11) Come back to this page and hit the finished race button.
                12) Check out your results and ranking!</p>
              </div>
              <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="Runners-tab">

                    <div class="runners-avatar">
                      <% @users.each do |user| %>
                        <%= link_to user_path(user) do %>
                          <% if user.photo.attached? %>
                                <div class="runner-avatar"><%= cl_image_tag user.photo.key, class:'avatar'%></div>
                          <% else %>
                                <div class="runner-avatar"><%= image_tag "avatar-default-copy.png", crop: :fill, class:'avatar' %></div>
                          <% end %>
                        <% end %>
                      <%end %>
                    </div>

              </div>
            </div>
          </div>
        </div>
      <% end %>

    <% end %>
  <% end %>




<%= bar_chart @track.races.where(status: 'finished').order('elapsed_time ASC').map(&:elapsed_time) %>

</div>










